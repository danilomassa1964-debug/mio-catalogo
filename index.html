<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Mio Catalogo Sfogliabile</title>
    
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <style>
        body { background-color: #333; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; font-family: sans-serif; }
        
        #flipbook {
            margin: auto;
            display: none; /* Nascondiamo finché non è pronto */
        }

        .page {
            background-color: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        #loading { color: white; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="loading">Preparazione pagine in corso... attendere.</div>
    <div id="flipbook"></div>

    <script>
        const url = 'documento.pdf'; // Verifica che il nome file sia identico
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        async function initCatalogo() {
            try {
                const pdf = await pdfjsLib.getDocument(url).promise;
                const container = document.getElementById('flipbook');

                // 1. Generiamo tutte le pagine
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: 1.5 });
                    
                    const pageDiv = document.createElement('div');
                    pageDiv.className = 'page';
                    
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    pageDiv.appendChild(canvas);
                    container.appendChild(pageDiv);

                    await page.render({ canvasContext: context, viewport: viewport }).promise;
                }

                // 2. Mostriamo il contenitore
                document.getElementById('loading').style.display = 'none';
                $("#flipbook").show();

                // 3. ATTIVIAMO TURN.JS con un piccolo ritardo per sicurezza
                setTimeout(function() {
                    $("#flipbook").turn({
                        width: 1000,
                        height: 700,
                        autoCenter: true,
                        gradients: true,
                        acceleration: true,
                        when: {
                            turning: function(event, page, view) {
                                console.log("Voltando pagina...");
                            }
                        }
                    });
                }, 500);

            } catch (error) {
                console.error("Errore:", error);
                document.getElementById('loading').innerText = "Errore nel caricamento del PDF.";
            }
        }

        initCatalogo();
    </script>
</body>
</html>

