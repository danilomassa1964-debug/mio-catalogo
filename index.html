<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Catalogo Sfogliabile</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://rawcdn.githack.com/blasten/turn.js/master/lib/turn.min.js"></script>

    <style>
        body { background-color: #222; margin: 0; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; color: white; }
        #flipbook { margin: 20px auto; display: none; }
        .page { background-color: white; }
        canvas { width: 100%; height: 100%; }
        .controls { margin-top: 20px; }
        button { padding: 10px 20px; cursor: pointer; background: #444; color: white; border: 1px solid #666; border-radius: 5px; margin: 0 10px; }
        button:hover { background: #666; }
        #loading { margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="loading">Caricamento PDF: <span id="percent">0</span>%</div>
    
    <div id="flipbook"></div>

    <div class="controls">
        <button onclick="$('#flipbook').turn('previous')">Indietro</button>
        <button onclick="$('#flipbook').turn('next')">Avanti</button>
    </div>

    <script>
        $(window).on('load', function() {
            const url = './documento.pdf';
            const pdfjsLib = window['pdfjs-dist/build/pdf'];
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

            async function init() {
                try {
                    const pdf = await pdfjsLib.getDocument(url).promise;
                    const container = document.getElementById('flipbook');

                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        // Usiamo una scala fissa piÃ¹ piccola per evitare blocchi
                        const viewport = page.getViewport({ scale: 0.7 });
                        
                        const pageDiv = document.createElement('div');
                        pageDiv.className = 'page';
                        const canvas = document.createElement('canvas');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        pageDiv.appendChild(canvas);
                        container.appendChild(pageDiv);

                        await page.render({ canvasContext: canvas.getContext('2d'), viewport: viewport }).promise;
                        document.getElementById('percent').innerText = Math.round((i / pdf.numPages) * 100);
                    }

                    $('#loading').hide();
                    const firstCanvas = container.querySelector('canvas');
                    
                    // Inizializzazione con misure forzate
                    $(container).show().turn({
                        width: firstCanvas.width * 2,
                        height: firstCanvas.height,
                        autoCenter: true,
                        display: 'double',
                        acceleration: true,
                        elevation: 50
                    });

                } catch (e) {
                    $('#loading').text("Errore caricamento: controlla che il file si chiami documento.pdf");
                }
            }
            init();
        });
    </script>
</body>
</html>
