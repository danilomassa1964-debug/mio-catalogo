let currentZoom = 1.0;
        let pdfDoc = null;
        const url = 'documento.pdf'; 
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

        function changeZoom(delta) {
            currentZoom += delta;
            if (currentZoom < 0.2) currentZoom = 0.2;
            document.getElementById('canvas-container').style.transform = `scale(${currentZoom})`;
        }

        async function init() {
            try {
                const loadingTask = pdfjsLib.getDocument(url);
                pdfDoc = await loadingTask.promise;
                const fb = $('#flipbook');
                const totalPages = pdfDoc.numPages;

                for (let i = 1; i <= totalPages; i++) {
                    fb.append(`<div class="page" id="page-${i}"><canvas></canvas></div>`);
                }

                const firstPage = await pdfDoc.getPage(1);
                // Usiamo una scala di base più piccola (1.0) per non esagerare con i pixel
                const viewport = firstPage.getViewport({ scale: 1.0 });
                
                // CALCOLO DIMENSIONI: Se il doppio della pagina è più largo del 90% dello schermo, ridimensioniamo
                let maxWidth = window.innerWidth * 0.9;
                let finalWidth = viewport.width * 2;
                let finalHeight = viewport.height;

                if (finalWidth > maxWidth) {
                    let ratio = maxWidth / finalWidth;
                    finalWidth = maxWidth;
                    finalHeight = viewport.height * ratio;
                }

                fb.show().turn({
                    width: finalWidth,
                    height: finalHeight,
                    autoCenter: true, // Questo centra il libro rispetto al contenitore
                    display: 'double',
                    acceleration: true,
                    elevation: 50,
                    pages: totalPages,
                    when: {
                        turning: function(e, page, view) {
                            renderP(page);
                            if (page + 1 <= totalPages) renderP(page + 1);
                        },
                        turned: function(e, page) {
                            // Se siamo alla pagina 1, Turn.js gestisce il centramento 
                            // ma forziamo la logica se necessario
                            console.log("Pagina attuale:", page);
                        }
                    }
                });

                await renderP(1);
                await renderP(2);
                
                $('#loading').fadeOut();

            } catch (err) {
                console.error(err);
                $('#loading').text("Errore. Verifica il file PDF.");
            }
        }

        async function renderP(num) {
            const pageDiv = $(`#page-${num}`);
            if (pageDiv.hasClass('loaded') || num > pdfDoc.numPages || num < 1) return;

            const page = await pdfDoc.getPage(num);
            const canvas = pageDiv.find('canvas')[0];
            const context = canvas.getContext('2d');
            
            // Renderizziamo a 1.5 per mantenere nitidezza nello zoom, 
            // ma il CSS lo terrà nelle dimensioni del flipbook
            const viewport = page.getViewport({ scale: 1.5 });

            canvas.width = viewport.width;
            canvas.height = viewport.height;

            await page.render({ canvasContext: context, viewport: viewport }).promise;
            pageDiv.addClass('loaded');
        }

        $(document).ready(init);
